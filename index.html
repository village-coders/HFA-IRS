<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HFA - Claims Management Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #003366;
            --secondary-color: #00509e;
            --accent-color: #4CAF50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --border-color: #dee2e6;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --border-radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Login Page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        
        .login-box {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 420px;
            padding: 40px;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo h1 {
            color: var(--primary-color);
            font-size: 28px;
            font-weight: 700;
        }
        
        .logo span {
            color: var(--secondary-color);
            font-weight: 300;
        }
        
        .logo p {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--secondary-color);
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
        }
        
        .btn:hover {
            background-color: var(--secondary-color);
        }
        
        /* Dashboard */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background-color: var(--primary-color);
            color: white;
            padding-top: 20px;
            position: fixed;
            height: 100%;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-header h2 {
            font-size: 20px;
            font-weight: 600;
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        
        .menu-item:hover, .menu-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: white;
        }
        
        .menu-item i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }
        
        .user-info {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-info p {
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .logout-btn {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
        }
        
        .logout-btn:hover {
            color: white;
        }
        
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 30px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: var(--primary-color);
            font-size: 28px;
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 24px;
        }
        
        .stat-content h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-content p {
            color: #666;
            font-size: 14px;
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .card-header h2 {
            color: var(--primary-color);
            font-size: 22px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 14px;
            margin-right: 5px;
        }
        
        .btn-success {
            background-color: var(--accent-color);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-info {
            background-color: #17a2b8;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            text-align: left;
            padding: 12px 15px;
            background-color: #f8f9fa;
            color: var(--primary-color);
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-new {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .status-pending {
            background-color: #fff3e0;
            color: #ef6c00;
        }
        
        .status-approved {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-verified {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-rejected {
            background-color: #ffebee;
            color: #c62828;
        }
        
        .status-paid {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-recommendation {
            background-color: #e1f5fe;
            color: #0277bd;
        }
        
        .user-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            background-color: #e9ecef;
            color: #495057;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-header h2 {
            color: var(--primary-color);
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-col {
            flex: 1;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .hidden {
            display: none;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ccc;
        }
        
        .error-message {
            color: #f44336;
            font-size: 14px;
            margin-top: 5px;
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar-header h2, .menu-item span, .user-info p:first-child {
                display: none;
            }
            
            .menu-item {
                justify-content: center;
                padding: 15px 0;
            }
            
            .menu-item i {
                margin-right: 0;
                font-size: 20px;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .user-info {
                padding: 15px 0;
                text-align: center;
            }
            
            .logout-btn span {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .card-header h2 {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="logo">
                <h1>HFA<span></span></h1>
                <p>Claims Management Dashboard</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Username or ID Number</label>
                    <input type="text" id="username" class="form-control" placeholder="Enter your username or ID" required>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                </div>
                
                <div class="form-group" id="loginError" style="display: none;">
                    <div class="error-message" id="loginErrorMessage"></div>
                </div>
                
                <button type="submit" class="btn" id="loginButton">
                    <span id="loginButtonText">Log In</span>
                    <span id="loginButtonSpinner" class="loading-spinner hidden"></span>
                </button>
            </form>
            
            <div class="demo-credentials" style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: var(--border-radius); font-size: 14px;">
                <p><strong>Note:</strong> Server sleeps on free tier.</p>
                <p>If login spins, please wait 60 seconds and try again.</p>
            </div>
        </div>
    </div>
    
    <div id="workerDashboard" class="dashboard-container hidden">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>HFA </h2>
                <p style="color: rgba(255,255,255,0.7); font-size: 14px;">Worker Dashboard</p>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-item active" data-section="manageClaim">
                    <i class="fas fa-tasks"></i>
                    <span>Manage Claim Sheet</span>
                </div>
                <div class="menu-item" data-section="newClaim">
                    <i class="fas fa-plus-circle"></i>
                    <span>New Claim</span>
                </div>
                <div class="menu-item" data-section="myClaims">
                    <i class="fas fa-file-alt"></i>
                    <span>My Claims</span>
                </div>
            </div>
            
            <div class="user-info">
                <p id="workerUserName">Loading...</p>
                <p id="workerUserId">Worker ID: Loading...</p>
                <a href="#" class="logout-btn" id="workerLogout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h1 id="workerPageTitle">Manage Claim Sheet</h1>
                <div class="date-display" id="currentDate"></div>
            </div>
            
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #e3f2fd; color: #1976d2;">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="workerTotalClaims">0</h3>
                        <p>Total Claims</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #fff3e0; color: #ef6c00;">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="workerPendingClaims">0</h3>
                        <p>Pending Claims</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #e8f5e9; color: #2e7d32;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="workerApprovedClaims">0</h3>
                        <p>Approved Claims</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #ffebee; color: #c62828;">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="workerRejectedClaims">0</h3>
                        <p>Rejected Claims</p>
                    </div>
                </div>
            </div>
            
            <div id="manageClaimSection" class="section active">
                <div class="card">
                    <div class="card-header">
                        <h2>My Claims</h2>
                        <div>
                            <button class="btn-primary" id="refreshClaimsBtn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                            <button class="btn-primary" id="newClaimBtnWorker">New Claim</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div id="workerClaimsLoading" class="empty-state">
                            <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                            <p>Loading claims...</p>
                        </div>
                        <table id="workerClaimsTable" style="display: none;">
                            <thead>
                                <tr>
                                    <th>Claim ID</th>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="workerClaimsTableBody">
                                </tbody>
                        </table>
                        <div id="workerClaimsEmpty" class="empty-state" style="display: none;">
                            <i class="fas fa-inbox"></i>
                            <p>No claims found</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="newClaimSection" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2>Submit New Claim</h2>
                        <button class="btn-secondary" id="cancelNewClaimBtn">Cancel</button>
                    </div>
                    
                    <div class="card-body">
                        <form id="newClaimForm">
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="claimDate">Date *</label>
                                        <input type="date" id="claimDate" class="form-control" required>
                                    </div>
                                </div>
                                
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="claimCategory">Category *</label>
                                        <select id="claimCategory" class="form-control" required>
                                            <option value="">Select Category</option>
                                            <option value="Office Supplies">Office Supplies</option>
                                            <option value="Furniture Repair">Furniture Repair</option>
                                            <option value="Equipment">Equipment</option>
                                            <option value="Travel">Travel</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="claimDescription">Description *</label>
                                <textarea id="claimDescription" class="form-control" rows="3" placeholder="Describe what you fixed or purchased for the company..." required></textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="claimAmount">Amount (£) *</label>
                                        <input type="number" id="claimAmount" class="form-control" min="0" step="0.01" placeholder="0.00" required>
                                    </div>
                                </div>
                                
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="claimReceipt">Receipt Available?</label>
                                        <select id="claimReceipt" class="form-control">
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="claimNotes">Additional Notes (Optional)</label>
                                <textarea id="claimNotes" class="form-control" rows="2" placeholder="Any additional information..."></textarea>
                            </div>
                            
                            <div id="claimFormError" class="form-group" style="display: none;">
                                <div class="error-message" id="claimFormErrorMessage"></div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" id="resetClaimForm">Reset</button>
                                <button type="submit" class="btn-primary" id="submitClaimBtn">
                                    <span id="submitClaimBtnText">Submit Claim</span>
                                    <span id="submitClaimBtnSpinner" class="loading-spinner hidden"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <div id="myClaimsSection" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2>All My Claims</h2>
                        <button class="btn-primary" id="refreshMyClaimsBtn">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <div id="myClaimsLoading" class="empty-state">
                            <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                            <p>Loading claims...</p>
                        </div>
                        <table id="myClaimsTable" style="display: none;">
                            <thead>
                                <tr>
                                    <th>Claim ID</th>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="myClaimsTableBody">
                                </tbody>
                        </table>
                        <div id="myClaimsEmpty" class="empty-state" style="display: none;">
                            <i class="fas fa-inbox"></i>
                            <p>No claims found</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="adminDashboard" class="dashboard-container hidden">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>HFA </h2>
                <p style="color: rgba(255,255,255,0.7); font-size: 14px;">Admin Dashboard</p>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-item active" data-section="adminManageClaim">
                    <i class="fas fa-tasks"></i>
                    <span>Manage Claims</span>
                </div>
                <div class="menu-item" data-section="adminNewClaim">
                    <i class="fas fa-plus-circle"></i>
                    <span>New Claim</span>
                </div>
                <div class="menu-item" data-section="adminUserManagement">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </div>
            </div>
            
            <div class="user-info">
                <p id="adminUserName">Admin User</p>
                <p>Administrator</p>
                <a href="#" class="logout-btn" id="adminLogout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <h1 id="adminPageTitle">Manage Claims</h1>
                <div class="date-display" id="adminCurrentDate"></div>
            </div>
            
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #e3f2fd; color: #1976d2;">
                        <i class="fas fa-file-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="adminTotalClaims">0</h3>
                        <p>Total Claims</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #fff3e0; color: #ef6c00;">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="adminPendingClaims">0</h3>
                        <p>Pending Claims</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #e8f5e9; color: #2e7d32;">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="adminApprovedClaims">0</h3>
                        <p>Approved Claims</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon" style="background-color: #ffebee; color: #c62828;">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="adminRejectedClaims">0</h3>
                        <p>Rejected Claims</p>
                    </div>
                </div>
            </div>
            
            <div id="adminManageClaimSection" class="section active">
                <div class="card">
                    <div class="card-header">
                        <h2>All Claims</h2>
                        <div>
                            <select id="filterStatus" class="form-control" style="display: inline-block; width: auto; margin-right: 10px;">
                                <option value="all">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <button class="btn-primary" id="refreshAdminClaimsBtn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div id="adminClaimsLoading" class="empty-state">
                            <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                            <p>Loading claims...</p>
                        </div>
                        <table id="adminClaimsTable" style="display: none;">
                            <thead>
                                <tr>
                                    <th>Claim ID</th>
                                    <th>User</th>
                                    <th>Date</th>
                                    <th>Description</th>
                                    <th>Category</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="adminClaimsTableBody">
                                </tbody>
                        </table>
                        <div id="adminClaimsEmpty" class="empty-state" style="display: none;">
                            <i class="fas fa-inbox"></i>
                            <p>No claims found</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="adminNewClaimSection" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2>Submit New Claim (Admin)</h2>
                        <button class="btn-secondary" id="cancelAdminNewClaimBtn">Cancel</button>
                    </div>
                    
                    <div class="card-body">
                        <form id="adminNewClaimForm">
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="adminClaimDate">Date *</label>
                                        <input type="date" id="adminClaimDate" class="form-control" required>
                                    </div>
                                </div>
                                
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="adminClaimCategory">Category *</label>
                                        <select id="adminClaimCategory" class="form-control" required>
                                            <option value="">Select Category</option>
                                            <option value="Office Supplies">Office Supplies</option>
                                            <option value="Furniture Repair">Furniture Repair</option>
                                            <option value="Equipment">Equipment</option>
                                            <option value="Travel">Travel</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="adminClaimDescription">Description *</label>
                                <textarea id="adminClaimDescription" class="form-control" rows="3" placeholder="Describe what you fixed or purchased for the company..." required></textarea>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="adminClaimAmount">Amount (£) *</label>
                                        <input type="number" id="adminClaimAmount" class="form-control" min="0" step="0.01" placeholder="0.00" required>
                                    </div>
                                </div>
                                
                                <div class="form-col">
                                    <div class="form-group">
                                        <label for="adminClaimReceipt">Receipt Available?</label>
                                        <select id="adminClaimReceipt" class="form-control">
                                            <option value="yes">Yes</option>
                                            <option value="no">No</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="adminClaimFormError" class="form-group" style="display: none;">
                                <div class="error-message" id="adminClaimFormErrorMessage"></div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" id="resetAdminClaimForm">Reset</button>
                                <button type="submit" class="btn-primary" id="submitAdminClaimBtn">
                                    <span id="submitAdminClaimBtnText">Submit Claim</span>
                                    <span id="submitAdminClaimBtnSpinner" class="loading-spinner hidden"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <div id="adminUserManagementSection" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2>User Management</h2>
                        <button class="btn-primary" id="createUserBtn">Create New User</button>
                    </div>
                    
                    <div class="card-body">
                        <div class="form-group">
                            <label for="userSearch">Search Users</label>
                            <input type="text" id="userSearch" class="form-control" placeholder="Search by name, email, or ID...">
                        </div>
                        
                        <div class="table-container">
                            <div id="usersLoading" class="empty-state">
                                <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                                <p>Loading users...</p>
                            </div>
                            <table id="usersTable" style="display: none;">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    </tbody>
                            </table>
                            <div id="usersEmpty" class="empty-state" style="display: none;">
                                <i class="fas fa-users"></i>
                                <p>No users found</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="viewClaimModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalClaimTitle">Claim Details</h2>
                <button class="close-btn" id="closeViewModal">&times;</button>
            </div>
            
            <div id="claimDetails">
                </div>
        </div>
    </div>
    
    <div id="createUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New User</h2>
                <button class="close-btn" id="closeCreateUserModal">&times;</button>
            </div>
            
            <div id="createUserDetails">
                <form id="createUserForm">
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="createUserName">Full Name *</label>
                                <input type="text" id="createUserName" class="form-control" placeholder="Enter full name" required>
                            </div>
                        </div>
                        
                        <div class="form-col">
                            <div class="form-group">
                                <label for="createUserEmail">Email Address *</label>
                                <input type="email" id="createUserEmail" class="form-control" placeholder="Enter email address" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label for="createUserPassword">Password *</label>
                                <input type="password" id="createUserPassword" class="form-control" placeholder="Enter password" required>
                            </div>
                        </div>
                        
                        <div class="form-col">
                            <div class="form-group">
                                <label for="createUserRole">Role *</label>
                                <select id="createUserRole" class="form-control" required>
                                    <option value="">Select Role</option>
                                    <option value="worker">Worker</option>
                                    <option value="admin">Administrator</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="createUserDepartment">Department</label>
                        <input type="text" id="createUserDepartment" class="form-control" placeholder="Enter department (optional)">
                    </div>
                    
                    <div id="createUserFormError" class="form-group" style="display: none;">
                        <div class="error-message" id="createUserFormErrorMessage"></div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="cancelCreateUser">Cancel</button>
                        <button type="submit" class="btn-primary" id="submitCreateUserBtn">
                            <span id="submitCreateUserBtnText">Create User</span>
                            <span id="submitCreateUserBtnSpinner" class="loading-spinner hidden"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        // Using a CORS proxy to bypass the restriction for localhost testing
        const API_BASE_URL = 'https://hfa-internal-record-system.onrender.com/api';
        
        // Current user data
        let currentUser = null;
        let authToken = null;
        
        // DOM elements
        const loginPage = document.getElementById('loginPage');
        const workerDashboard = document.getElementById('workerDashboard');
        const adminDashboard = document.getElementById('adminDashboard');
        const loginForm = document.getElementById('loginForm');
        const loginButton = document.getElementById('loginButton');
        const loginButtonText = document.getElementById('loginButtonText');
        const loginButtonSpinner = document.getElementById('loginButtonSpinner');
        const loginError = document.getElementById('loginError');
        const loginErrorMessage = document.getElementById('loginErrorMessage');
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            const now = new Date();
            const formattedDate = now.toLocaleDateString('en-GB', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            document.getElementById('currentDate').textContent = formattedDate;
            document.getElementById('adminCurrentDate').textContent = formattedDate;
            
            // Set default date in claim forms to today
            const today = now.toISOString().split('T')[0];
            document.getElementById('claimDate').value = today;
            document.getElementById('adminClaimDate').value = today;
            
            // Check for saved token
            const savedToken = localStorage.getItem('hfa_auth_token');
            const savedUser = localStorage.getItem('hfa_user');
            
            if (savedToken && savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    authToken = savedToken;
                    
                    if (currentUser.role === 'worker') {
                        showWorkerDashboard();
                    } else if (currentUser.role === 'admin') {
                        showAdminDashboard();
                    }
                } catch (e) {
                    localStorage.removeItem('hfa_auth_token');
                    localStorage.removeItem('hfa_user');
                }
            }
            
            // Login form submission with ROBUST PAYLOAD FIX
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // Show loading state
                loginButton.disabled = true;
                loginButtonText.textContent = 'Logging in...';
                loginButtonSpinner.classList.remove('hidden');
                loginError.style.display = 'none';
                
                try {
                    // Send both email and username keys to satisfy backend requirements
                    const response = await fetch(`${API_BASE_URL}/auth/login`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            email: username,
                            username: username,
                            password: password
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // Save token and user data
                        authToken = data.token;
                        currentUser = data.user;
                        
                        localStorage.setItem('hfa_auth_token', authToken);
                        localStorage.setItem('hfa_user', JSON.stringify(currentUser));
                        
                        if (currentUser.role === 'worker') {
                            showWorkerDashboard();
                        } else if (currentUser.role === 'admin') {
                            showAdminDashboard();
                        }
                        
                        showToast('Login successful!', 'success');
                    } else {
                        throw new Error(data.message || 'Login failed');
                    }
                } catch (error) {
                    loginError.style.display = 'block';
                    loginErrorMessage.textContent = error.message;
                    showToast(error.message, 'error');
                } finally {
                    // Reset loading state
                    loginButton.disabled = false;
                    loginButtonText.textContent = 'Log In';
                    loginButtonSpinner.classList.add('hidden');
                }
            });
            
            // Worker dashboard events
            document.getElementById('workerLogout').addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });
            
            document.getElementById('newClaimBtnWorker').addEventListener('click', function() {
                switchWorkerSection('newClaimSection', 'New Claim');
            });
            
            document.getElementById('cancelNewClaimBtn').addEventListener('click', function() {
                switchWorkerSection('manageClaimSection', 'Manage Claim Sheet');
            });
            
            document.getElementById('refreshClaimsBtn').addEventListener('click', function() {
                loadWorkerClaims();
            });
            
            document.getElementById('refreshMyClaimsBtn').addEventListener('click', function() {
                loadWorkerClaims();
            });
            
            // Worker menu navigation
            const workerMenuItems = document.querySelectorAll('#workerDashboard .menu-item');
            workerMenuItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all items
                    workerMenuItems.forEach(i => i.classList.remove('active'));
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    const section = this.getAttribute('data-section');
                    switchWorkerSection(section + 'Section', this.querySelector('span').textContent);
                });
            });
            
            // Worker new claim form
            document.getElementById('newClaimForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await submitNewClaim('worker');
            });
            
            document.getElementById('resetClaimForm').addEventListener('click', function() {
                document.getElementById('newClaimForm').reset();
                document.getElementById('claimDate').value = today;
                document.getElementById('claimFormError').style.display = 'none';
            });
            
            // Admin dashboard events
            document.getElementById('adminLogout').addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });
            
            document.getElementById('cancelAdminNewClaimBtn').addEventListener('click', function() {
                switchAdminSection('adminManageClaimSection', 'Manage Claims');
            });
            
            document.getElementById('refreshAdminClaimsBtn').addEventListener('click', function() {
                loadAdminClaims();
            });
            
            document.getElementById('resetAdminClaimForm').addEventListener('click', function() {
                document.getElementById('adminNewClaimForm').reset();
                document.getElementById('adminClaimDate').value = today;
                document.getElementById('adminClaimFormError').style.display = 'none';
            });
            
            // Admin menu navigation
            const adminMenuItems = document.querySelectorAll('#adminDashboard .menu-item');
            adminMenuItems.forEach(item => {
                item.addEventListener('click', function() {
                    // Remove active class from all items
                    adminMenuItems.forEach(i => i.classList.remove('active'));
                    // Add active class to clicked item
                    this.classList.add('active');
                    
                    const section = this.getAttribute('data-section');
                    switchAdminSection(section + 'Section', this.querySelector('span').textContent);
                });
            });
            
            // Admin new claim form
            document.getElementById('adminNewClaimForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await submitNewClaim('admin');
            });
            
            // User management
            document.getElementById('createUserBtn').addEventListener('click', function() {
                document.getElementById('createUserModal').style.display = 'flex';
                document.getElementById('createUserForm').reset();
            });
            
            document.getElementById('closeCreateUserModal').addEventListener('click', function() {
                document.getElementById('createUserModal').style.display = 'none';
            });
            
            document.getElementById('cancelCreateUser').addEventListener('click', function() {
                document.getElementById('createUserModal').style.display = 'none';
            });
            
            document.getElementById('createUserForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await createUser();
            });
            
            // Filter status for admin
            document.getElementById('filterStatus').addEventListener('change', function() {
                loadAdminClaims();
            });
            
            // User search
            document.getElementById('userSearch').addEventListener('input', function() {
                filterUsers(this.value);
            });
            
            // Close modals when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target === document.getElementById('viewClaimModal')) {
                    document.getElementById('viewClaimModal').style.display = 'none';
                }
                if (e.target === document.getElementById('createUserModal')) {
                    document.getElementById('createUserModal').style.display = 'none';
                }
            });
            
            // Close view claim modal
            document.getElementById('closeViewModal').addEventListener('click', function() {
                document.getElementById('viewClaimModal').style.display = 'none';
            });
        });
        
        // Function to show worker dashboard
        function showWorkerDashboard() {
            loginPage.classList.add('hidden');
            workerDashboard.classList.remove('hidden');
            
            // Update user info
            document.getElementById('workerUserName').textContent = currentUser.name || currentUser.email;
            document.getElementById('workerUserId').textContent = `Worker ID: ${currentUser.id || 'N/A'}`;
            
            // Load claims
            loadWorkerClaims();
        }
        
        // Function to show admin dashboard
        function showAdminDashboard() {
            loginPage.classList.add('hidden');
            adminDashboard.classList.remove('hidden');
            
            // Update user info
            document.getElementById('adminUserName').textContent = currentUser.name || currentUser.email;
            
            // Load claims and users
            loadAdminClaims();
            loadUsers();
        }
        
        // Function to switch worker sections
        function switchWorkerSection(sectionId, pageTitle) {
            // Hide all sections
            document.querySelectorAll('#workerDashboard .section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show the selected section
            const sectionElement = document.getElementById(sectionId);
            if (sectionElement) {
                sectionElement.classList.add('active');
            }
            
            // Update page title
            document.getElementById('workerPageTitle').textContent = pageTitle;
            
            // Load data if needed
            if (sectionId === 'myClaimsSection') {
                loadWorkerClaims();
            }
        }
        
        // Function to switch admin sections
        function switchAdminSection(sectionId, pageTitle) {
            // Hide all sections
            document.querySelectorAll('#adminDashboard .section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show the selected section
            const sectionElement = document.getElementById(sectionId);
            if (sectionElement) {
                sectionElement.classList.add('active');
            }
            
            // Update page title
            document.getElementById('adminPageTitle').textContent = pageTitle;
        }
        
        // Function to load worker claims
        async function loadWorkerClaims() {
            if (!currentUser || !authToken) return;
            
            const tableBody = document.getElementById('workerClaimsTableBody');
            const myClaimsTableBody = document.getElementById('myClaimsTableBody');
            const loadingElement = document.getElementById('workerClaimsLoading');
            const emptyElement = document.getElementById('workerClaimsEmpty');
            const tableElement = document.getElementById('workerClaimsTable');
            
            const myClaimsLoadingElement = document.getElementById('myClaimsLoading');
            const myClaimsEmptyElement = document.getElementById('myClaimsEmpty');
            const myClaimsTableElement = document.getElementById('myClaimsTable');
            
            // Show loading state
            loadingElement.style.display = 'block';
            emptyElement.style.display = 'none';
            tableElement.style.display = 'none';
            
            myClaimsLoadingElement.style.display = 'block';
            myClaimsEmptyElement.style.display = 'none';
            myClaimsTableElement.style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE_URL}/claim/my-claim`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.status === 401) {
                    logout();
                    throw new Error('Session expired. Please login again.');
                }
                
                const data = await response.json();
                
                if (response.ok) {
                    // Clear tables
                    tableBody.innerHTML = '';
                    myClaimsTableBody.innerHTML = '';
                    
                    if (data.claims && data.claims.length > 0) {
                        // Update stats
                        updateWorkerStats(data.claims);
                        
                        // Populate tables
                        data.claims.forEach(claim => {
                            const row = createClaimRow(claim, false);
                            tableBody.appendChild(row.cloneNode(true));
                            myClaimsTableBody.appendChild(row);
                        });
                        
                        // Show tables
                        loadingElement.style.display = 'none';
                        tableElement.style.display = 'table';
                        
                        myClaimsLoadingElement.style.display = 'none';
                        myClaimsTableElement.style.display = 'table';
                    } else {
                        // Show empty state
                        loadingElement.style.display = 'none';
                        emptyElement.style.display = 'block';
                        
                        myClaimsLoadingElement.style.display = 'none';
                        myClaimsEmptyElement.style.display = 'block';
                        
                        // Reset stats
                        resetWorkerStats();
                    }
                } else {
                    throw new Error(data.message || 'Failed to load claims');
                }
            } catch (error) {
                showToast(error.message, 'error');
                
                // Show empty state
                loadingElement.style.display = 'none';
                emptyElement.style.display = 'block';
                
                myClaimsLoadingElement.style.display = 'none';
                myClaimsEmptyElement.style.display = 'block';
                
                resetWorkerStats();
            }
        }
        
        // Function to load admin claims
        async function loadAdminClaims() {
            if (!currentUser || !authToken) return;
            
            const tableBody = document.getElementById('adminClaimsTableBody');
            const loadingElement = document.getElementById('adminClaimsLoading');
            const emptyElement = document.getElementById('adminClaimsEmpty');
            const tableElement = document.getElementById('adminClaimsTable');
            const filterStatus = document.getElementById('filterStatus').value;
            
            // Show loading state
            loadingElement.style.display = 'block';
            emptyElement.style.display = 'none';
            tableElement.style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE_URL}/claim/all`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.status === 401) {
                    logout();
                    throw new Error('Session expired. Please login again.');
                }
                
                const data = await response.json();
                
                if (response.ok) {
                    // Clear table
                    tableBody.innerHTML = '';
                    
                    if (data.claims && data.claims.length > 0) {
                        // Filter claims
                        let filteredClaims = data.claims;
                        if (filterStatus !== 'all') {
                            filteredClaims = data.claims.filter(claim => claim.status === filterStatus);
                        }
                        
                        // Update stats
                        updateAdminStats(data.claims);
                        
                        if (filteredClaims.length > 0) {
                            // Populate table
                            filteredClaims.forEach(claim => {
                                const row = createClaimRow(claim, true);
                                tableBody.appendChild(row);
                            });
                            
                            // Show table
                            loadingElement.style.display = 'none';
                            tableElement.style.display = 'table';
                        } else {
                            // Show empty state
                            loadingElement.style.display = 'none';
                            emptyElement.style.display = 'block';
                        }
                    } else {
                        // Show empty state
                        loadingElement.style.display = 'none';
                        emptyElement.style.display = 'block';
                        resetAdminStats();
                    }
                } else {
                    throw new Error(data.message || 'Failed to load claims');
                }
            } catch (error) {
                showToast(error.message, 'error');
                
                // Show empty state
                loadingElement.style.display = 'none';
                emptyElement.style.display = 'block';
                resetAdminStats();
            }
        }
        
        // Function to load users
        async function loadUsers() {
            // Note: The API doesn't have a users endpoint
            // In a real implementation, you would fetch users from the backend
            // For now, we'll show a message
            const tableBody = document.getElementById('usersTableBody');
            const loadingElement = document.getElementById('usersLoading');
            const emptyElement = document.getElementById('usersEmpty');
            const tableElement = document.getElementById('usersTable');
            
            loadingElement.style.display = 'none';
            emptyElement.style.display = 'block';
            tableElement.style.display = 'none';
            
            // showToast('User management requires backend implementation', 'info');
        }
        
        // Function to create a claim row
        function createClaimRow(claim, isAdmin = false) {
            const row = document.createElement('tr');
            
            // Status badge
            let statusBadge = getStatusBadge(claim.status);
            
            // Format date
            const dateObj = new Date(claim.createdAt || claim.date);
            const formattedDate = dateObj.toLocaleDateString('en-GB');
            
            // Get user info for admin view
            let userInfo = '';
            if (isAdmin && claim.user) {
                userInfo = `${claim.user.name || claim.user.email} <span class="user-badge">${claim.user.id || 'N/A'}</span>`;
            }
            
            row.innerHTML = `
                <td>${claim.id || claim._id || 'N/A'}</td>
                ${isAdmin ? `<td>${userInfo}</td>` : ''}
                <td>${formattedDate}</td>
                <td>${claim.description || 'No description'}</td>
                <td>${claim.category || 'Uncategorized'}</td>
                <td>£${parseFloat(claim.amount || 0).toFixed(2)}</td>
                <td>${statusBadge}</td>
                <td>
                    <button class="btn-primary btn-small view-claim-btn" data-id="${claim._id || claim.id}" data-admin="${isAdmin}">View</button>
                    ${!isAdmin && (claim.status === 'pending' || claim.status === 'new') ? `
                        <button class="btn-danger btn-small delete-claim-btn" data-id="${claim._id || claim.id}">Delete</button>
                    ` : ''}
                    ${isAdmin && claim.status === 'pending' ? `
                        <button class="btn-success btn-small approve-claim-btn" data-id="${claim._id || claim.id}">Approve</button>
                        <button class="btn-danger btn-small reject-claim-btn" data-id="${claim._id || claim.id}">Reject</button>
                    ` : ''}
                </td>
            `;
            
            return row;
        }
        
        // Function to get status badge HTML
        function getStatusBadge(status) {
            switch(status) {
                case 'new':
                case 'pending':
                    return '<span class="status-badge status-pending">Pending</span>';
                case 'approved':
                    return '<span class="status-badge status-approved">Approved</span>';
                case 'rejected':
                    return '<span class="status-badge status-rejected">Rejected</span>';
                case 'paid':
                    return '<span class="status-badge status-paid">Paid</span>';
                default:
                    return `<span class="status-badge">${status || 'Unknown'}</span>`;
            }
        }
        
        // Function to submit a new claim
        async function submitNewClaim(role) {
            if (!currentUser || !authToken) {
                showToast('Please login first', 'error');
                return;
            }
            
            let claimDate, claimCategory, claimDescription, claimAmount, claimNotes, claimReceipt;
            let submitBtn, submitBtnText, submitBtnSpinner, formError, formErrorMessage;
            
            if (role === 'worker') {
                claimDate = document.getElementById('claimDate').value;
                claimCategory = document.getElementById('claimCategory').value;
                claimDescription = document.getElementById('claimDescription').value;
                claimAmount = document.getElementById('claimAmount').value;
                claimNotes = document.getElementById('claimNotes').value;
                claimReceipt = document.getElementById('claimReceipt').value;
                submitBtn = document.getElementById('submitClaimBtn');
                submitBtnText = document.getElementById('submitClaimBtnText');
                submitBtnSpinner = document.getElementById('submitClaimBtnSpinner');
                formError = document.getElementById('claimFormError');
                formErrorMessage = document.getElementById('claimFormErrorMessage');
            } else {
                claimDate = document.getElementById('adminClaimDate').value;
                claimCategory = document.getElementById('adminClaimCategory').value;
                claimDescription = document.getElementById('adminClaimDescription').value;
                claimAmount = document.getElementById('adminClaimAmount').value;
                claimReceipt = document.getElementById('adminClaimReceipt').value;
                claimNotes = '';
                submitBtn = document.getElementById('submitAdminClaimBtn');
                submitBtnText = document.getElementById('submitAdminClaimBtnText');
                submitBtnSpinner = document.getElementById('submitAdminClaimBtnSpinner');
                formError = document.getElementById('adminClaimFormError');
                formErrorMessage = document.getElementById('adminClaimFormErrorMessage');
            }
            
            // Validate
            if (!claimDate || !claimCategory || !claimDescription || !claimAmount) {
                formError.style.display = 'block';
                formErrorMessage.textContent = 'Please fill in all required fields';
                return;
            }
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtnText.textContent = 'Submitting...';
            submitBtnSpinner.classList.remove('hidden');
            formError.style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE_URL}/claim/create`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        date: claimDate,
                        category: claimCategory,
                        description: claimDescription,
                        amount: parseFloat(claimAmount),
                        receipt: claimReceipt === 'yes',
                        notes: claimNotes
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showToast('Claim submitted successfully!', 'success');
                    
                    // Reset form
                    if (role === 'worker') {
                        document.getElementById('newClaimForm').reset();
                        document.getElementById('claimDate').value = new Date().toISOString().split('T')[0];
                        switchWorkerSection('manageClaimSection', 'Manage Claim Sheet');
                    } else {
                        document.getElementById('adminNewClaimForm').reset();
                        document.getElementById('adminClaimDate').value = new Date().toISOString().split('T')[0];
                        switchAdminSection('adminManageClaimSection', 'Manage Claims');
                    }
                    
                    // Refresh claims
                    if (role === 'worker') {
                        loadWorkerClaims();
                    } else {
                        loadAdminClaims();
                    }
                } else {
                    throw new Error(data.message || 'Failed to submit claim');
                }
            } catch (error) {
                formError.style.display = 'block';
                formErrorMessage.textContent = error.message;
                showToast(error.message, 'error');
            } finally {
                // Reset loading state
                submitBtn.disabled = false;
                submitBtnText.textContent = 'Submit Claim';
                submitBtnSpinner.classList.add('hidden');
            }
        }
        
        // Function to create a new user
        async function createUser() {
            if (!currentUser || !authToken) {
                showToast('Please login first', 'error');
                return;
            }
            
            const userName = document.getElementById('createUserName').value;
            const userEmail = document.getElementById('createUserEmail').value;
            const userPassword = document.getElementById('createUserPassword').value;
            const userRole = document.getElementById('createUserRole').value;
            const userDepartment = document.getElementById('createUserDepartment').value;
            const submitBtn = document.getElementById('submitCreateUserBtn');
            const submitBtnText = document.getElementById('submitCreateUserBtnText');
            const submitBtnSpinner = document.getElementById('submitCreateUserBtnSpinner');
            const formError = document.getElementById('createUserFormError');
            const formErrorMessage = document.getElementById('createUserFormErrorMessage');
            
            // Validate
            if (!userName || !userEmail || !userPassword || !userRole) {
                formError.style.display = 'block';
                formErrorMessage.textContent = 'Please fill in all required fields';
                return;
            }
            
            // Show loading state
            submitBtn.disabled = true;
            submitBtnText.textContent = 'Creating...';
            submitBtnSpinner.classList.remove('hidden');
            formError.style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/signup`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: userName,
                        email: userEmail,
                        password: userPassword,
                        role: userRole,
                        department: userDepartment || undefined
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showToast('User created successfully!', 'success');
                    
                    // Close modal and reset form
                    document.getElementById('createUserModal').style.display = 'none';
                    document.getElementById('createUserForm').reset();
                    
                    // Refresh users list
                    loadUsers();
                } else {
                    throw new Error(data.message || 'Failed to create user');
                }
            } catch (error) {
                formError.style.display = 'block';
                formErrorMessage.textContent = error.message;
                showToast(error.message, 'error');
            } finally {
                // Reset loading state
                submitBtn.disabled = false;
                submitBtnText.textContent = 'Create User';
                submitBtnSpinner.classList.add('hidden');
            }
        }
        
        // Function to update worker stats
        function updateWorkerStats(claims) {
            const total = claims.length;
            const pending = claims.filter(c => c.status === 'pending' || c.status === 'new').length;
            const approved = claims.filter(c => c.status === 'approved').length;
            const rejected = claims.filter(c => c.status === 'rejected').length;
            
            document.getElementById('workerTotalClaims').textContent = total;
            document.getElementById('workerPendingClaims').textContent = pending;
            document.getElementById('workerApprovedClaims').textContent = approved;
            document.getElementById('workerRejectedClaims').textContent = rejected;
        }
        
        // Function to reset worker stats
        function resetWorkerStats() {
            document.getElementById('workerTotalClaims').textContent = '0';
            document.getElementById('workerPendingClaims').textContent = '0';
            document.getElementById('workerApprovedClaims').textContent = '0';
            document.getElementById('workerRejectedClaims').textContent = '0';
        }
        
        // Function to update admin stats
        function updateAdminStats(claims) {
            const total = claims.length;
            const pending = claims.filter(c => c.status === 'pending' || c.status === 'new').length;
            const approved = claims.filter(c => c.status === 'approved').length;
            const rejected = claims.filter(c => c.status === 'rejected').length;
            
            document.getElementById('adminTotalClaims').textContent = total;
            document.getElementById('adminPendingClaims').textContent = pending;
            document.getElementById('adminApprovedClaims').textContent = approved;
            document.getElementById('adminRejectedClaims').textContent = rejected;
        }
        
        // Function to reset admin stats
        function resetAdminStats() {
            document.getElementById('adminTotalClaims').textContent = '0';
            document.getElementById('adminPendingClaims').textContent = '0';
            document.getElementById('adminApprovedClaims').textContent = '0';
            document.getElementById('adminRejectedClaims').textContent = '0';
        }
        
        // Function to filter users
        function filterUsers(searchTerm) {
            const tableBody = document.getElementById('usersTableBody');
            const rows = tableBody.getElementsByTagName('tr');
            
            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm.toLowerCase())) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        }
        
        // Function to handle button clicks in tables
        document.addEventListener('click', async function(e) {
            // View claim button
            if (e.target.classList.contains('view-claim-btn')) {
                const claimId = e.target.getAttribute('data-id');
                const isAdmin = e.target.getAttribute('data-admin') === 'true';
                await viewClaimDetails(claimId, isAdmin);
            }
            
            // Delete claim button (worker only)
            if (e.target.classList.contains('delete-claim-btn')) {
                const claimId = e.target.getAttribute('data-id');
                await deleteClaim(claimId);
            }
            
            // Approve claim button (admin only)
            if (e.target.classList.contains('approve-claim-btn')) {
                const claimId = e.target.getAttribute('data-id');
                await updateClaimStatus(claimId, 'approved');
            }
            
            // Reject claim button (admin only)
            if (e.target.classList.contains('reject-claim-btn')) {
                const claimId = e.target.getAttribute('data-id');
                await updateClaimStatus(claimId, 'rejected');
            }
        });
        
        // Function to view claim details
        async function viewClaimDetails(claimId, isAdmin = false) {
            try {
                // We use the existing loaded data if possible, or fetch it
                // Since we don't store claims globally, we'll fetch all again
                const response = await fetch(`${API_BASE_URL}/claim/all`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const claim = data.claims.find(c => c._id === claimId || c.id === claimId);
                    
                    if (claim) {
                        displayClaimModal(claim, isAdmin);
                    } else {
                        showToast('Claim not found', 'error');
                    }
                } else {
                    throw new Error('Failed to load claim details');
                }
            } catch (error) {
                showToast(error.message, 'error');
            }
        }
        
        // Function to display claim modal
        function displayClaimModal(claim, isAdmin = false) {
            // Format date
            const dateObj = new Date(claim.createdAt || claim.date);
            const formattedDate = dateObj.toLocaleDateString('en-GB');
            
            // Status display
            let statusBadge = getStatusBadge(claim.status);
            
            // Create details HTML
            let detailsHTML = `
                <div style="margin-bottom: 20px;">
                    <p><strong>Claim ID:</strong> ${claim._id || claim.id}</p>
                    ${claim.user ? `<p><strong>Submitted By:</strong> ${claim.user.name || claim.user.email}</p>` : ''}
                    <p><strong>Date Submitted:</strong> ${formattedDate}</p>
                    <p><strong>Status:</strong> ${statusBadge}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p><strong>Category:</strong> ${claim.category || 'Uncategorized'}</p>
                    <p><strong>Amount:</strong> £${parseFloat(claim.amount || 0).toFixed(2)}</p>
                    <p><strong>Receipt Available:</strong> ${claim.receipt ? 'Yes' : 'No'}</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p><strong>Description:</strong></p>
                    <div style="background-color: #f8f9fa; padding: 15px; border-radius: var(--border-radius); margin-bottom: 10px;">
                        ${claim.description || 'No description'}
                    </div>
                </div>
            `;
            
            // Add notes if available
            if (claim.notes) {
                detailsHTML += `
                    <div style="margin-bottom: 20px;">
                        <p><strong>Notes:</strong></p>
                        <div style="background-color: #f8f9fa; padding: 15px; border-radius: var(--border-radius);">
                            ${claim.notes}
                        </div>
                    </div>
                `;
            }
            
            // Set modal content
            document.getElementById('claimDetails').innerHTML = detailsHTML;
            document.getElementById('modalClaimTitle').textContent = `Claim Details: ${claim._id || claim.id}`;
            
            // Show modal
            document.getElementById('viewClaimModal').style.display = 'flex';
        }
        
        // Function to delete a claim
        async function deleteClaim(claimId) {
            if (!confirm('Are you sure you want to delete this claim?')) return;
            
            try {
                // Mock implementation
                showToast('Delete functionality requires backend implementation', 'info');
                
            } catch (error) {
                showToast(error.message, 'error');
            }
        }
        
        // Function to update claim status
        async function updateClaimStatus(claimId, status) {
            try {
                // Mock implementation
                showToast('Update status functionality requires backend implementation', 'info');
                
            } catch (error) {
                showToast(error.message, 'error');
            }
        }
        
        // Function to logout
        function logout() {
            localStorage.removeItem('hfa_auth_token');
            localStorage.removeItem('hfa_user');
            currentUser = null;
            authToken = null;
            
            workerDashboard.classList.add('hidden');
            adminDashboard.classList.add('hidden');
            loginPage.classList.remove('hidden');
            loginForm.reset();
            
            showToast('You have been logged out.', 'info');
        }
        
        // Function to show toast notifications
        function showToast(message, type = "success") {
            // Remove existing toasts
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => toast.remove());
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            // Style the toast
            toast.style.position = 'fixed';
            toast.style.bottom = '20px';
            toast.style.right = '20px';
            toast.style.backgroundColor = type === 'error' ? '#f44336' : 
                                          type === 'info' ? '#2196f3' : 
                                          type === 'warning' ? '#ff9800' : '#4CAF50';
            toast.style.color = 'white';
            toast.style.padding = '12px 24px';
            toast.style.borderRadius = '4px';
            toast.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
            toast.style.zIndex = '10000';
            toast.style.fontWeight = '500';
            
            // Add to document
            document.body.appendChild(toast);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>